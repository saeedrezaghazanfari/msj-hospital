{% extends 'website/shared/_main_layout.html' %}
{% load static i18n widget_tweaks web_tags %}
{% block title %}{% translate 'خانه' %}{% endblock %}
{% block extraCss %}
<meta name="keywords" content="">
{% endblock %}

{% block content %}

    <div>
        <form class="d-flex" method="GET" action="{% url 'website:search' %}">
            <input type="text" name="query" oninput="search_query_txt()" id="querysearch" placeholder="جستجو کنید" class="text-center" style="flex: 5;">
            <button class="btn btn-primary mx-1" type="submit" style="flex: 1;">جستجو</button>
        </form>

        <br>

        <h3>نمایش خروحی</h3>
        <p id="queryshow">عبارت جستجو شده ی شما: <span></span><br><b></b></p>
        <div id="wrapper-outputs">
        </div>

    </div>

{% endblock %}

{% block extraScript %}

<script>

    window.onload = function() {
        let searched = window.location.search;
        let query = searched.substring(7);
        document.getElementById('querysearch').value = query;
        search_query_txt();
    };

    function search_query_txt() {

        let host = window.location.host;
        let lang = `${window.location.pathname[1]}${window.location.pathname[2]}`;
        let query = document.getElementById('querysearch');
        let outputs = [];

        if(query.value.length >= 1)
            document.querySelector('#queryshow').classList.remove('d-none')
        else
            document.querySelector('#queryshow').classList.add('d-none')

        document.getElementById('wrapper-outputs').innerHTML = '';
        document.querySelector('#queryshow span').innerHTML = '';
        
        let links = [
            
            [ /* panel */
                `${host}/${lang}/1/`, [
                    'word1', 'word2', 'word3'
                ]
            ],

            [ /* panel */
                `${host}/${lang}/2/`, [
                    'word4', 'word5', 'word6', 'word1'
                ]
            ],

        ];

        links.forEach(link => {
            link[1].forEach(item => {
                
                if(item.includes(query.value) && query.value.length >= 1){
                    outputs.push([item, link[0]]);
                    document.querySelector('#queryshow span').innerHTML = query.value;
                }
                
            });
        });

        document.querySelector('#queryshow b').innerHTML = `نتیجه(${outputs.length})`;

        outputs.forEach(element => {
            document.getElementById('wrapper-outputs').innerHTML += `<div class="alert alert-light text-primary div-outputs"><a target="_blank" href="${element[1]}">${element[0]}</a></div>`;
        });
    }

</script>
{% endblock %}
